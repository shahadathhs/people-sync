model Survey {
  id String @id @default(uuid())

  title       String
  description String?

  questions   Question[]
  assignments Assignment[]

  createdAt DateTime @default(now())
  updatedAt DateTime @default(now()) @updatedAt

  @@map("surveys")
}

model Question {
  id String @id @default(uuid())

  text String

  type QuestionType

  survey   Survey @relation(fields: [surveyId], references: [id], onDelete: Cascade)
  surveyId String

  options   Option[] // for MULTI_CHOICE questions
  responses SurveyResponse[]

  createdAt DateTime @default(now())
  updatedAt DateTime @default(now()) @updatedAt
}

enum QuestionType {
  OPEN_ENDED
  MULTI_CHOICE
  RATING
}

model Option {
  id   String @id @default(uuid())
  text String

  question   Question @relation(fields: [questionId], references: [id], onDelete: Cascade)
  questionId String
}

model SurveyResponse {
  id String @id @default(uuid())

  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId String

  question   Question @relation(fields: [questionId], references: [id], onDelete: Cascade)
  questionId String

  answer String // text, optionId, JSON, or rating value

  createdAt DateTime @default(now())
}

model Poll {
  id       String @id @default(uuid())
  question String

  options     PollOption[]
  responses   PollResponse[]
  assignments Assignment[]

  createdAt DateTime @default(now())
  updatedAt DateTime @default(now()) @updatedAt
}

model PollOption {
  id   String @id @default(uuid())
  text String

  poll   Poll   @relation(fields: [pollId], references: [id], onDelete: Cascade)
  pollId String
}

model PollResponse {
  id String @id @default(uuid())

  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId String

  poll   Poll   @relation(fields: [pollId], references: [id], onDelete: Cascade)
  pollId String

  answer String // text, optionId, JSON, or rating value

  createdAt DateTime @default(now())
}

// ========================
// ASSIGNMENTS
// ========================
model Assignment {
  id String @id @default(uuid())

  type AssignmentType

  surveyId String? // optional
  survey   Survey? @relation(fields: [surveyId], references: [id], onDelete: Cascade)

  pollId String? // optional
  poll   Poll?   @relation(fields: [pollId], references: [id], onDelete: Cascade)

  targets AssignmentTarget[]

  createdAt DateTime @default(now())
}

enum AssignmentType {
  SURVEY
  POLL
}

model AssignmentTarget {
  id String @id @default(uuid())

  assignment   Assignment @relation(fields: [assignmentId], references: [id], onDelete: Cascade)
  assignmentId String

  targetType TargetType
  targetId   String // companyId, branchId, departmentId, designationId, or userId
}

enum TargetType {
  COMPANY
  BRANCH
  DEPARTMENT
  DESIGNATION
  USER
}
